<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Financial Advice Engine</title>
  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin:0; }
    .wrap { display:grid; min-height:100vh; place-items:center; }
    .col { width:min(760px, 92vw); margin-inline:auto; padding:2rem 1rem; }
    h1 { text-align:center; margin:0 0 1rem; font-size:clamp(20px, 4vw, 32px); }
    form { display:grid; gap:.75rem; }
    textarea, button { padding: .85rem 1rem; font-size:1.05rem; border-radius:12px; }
    textarea { height: 7.5rem; }
    button { cursor:pointer; }
    .hint { opacity:.7; font-size:.95rem; margin:.25rem 0 1rem; text-align:center; }
    .examples { display:flex; flex-wrap:wrap; gap:.5rem; justify-content:center; margin-bottom:1rem; }
    .pill { border:1px solid #ccc; padding:.35rem .6rem; border-radius:999px; font-size:.92rem; }
    .result { margin-top:1.25rem; padding:1rem; border:1px solid #ddd; border-radius:12px; }
    .kv { display:grid; grid-template-columns: 220px 1fr; gap:.25rem .75rem; }
    .topnav { text-align:center; margin-top:.5rem; }
    .topnav a { text-decoration:none; }
    .advice { margin-top:.75rem; padding:.75rem; background:rgba(0,0,0,.04); border-radius:10px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="col">
      <h1>Financial Advice Engine</h1>

      <div class="topnav">
        <a href="/structured">Structured input form</a>
      </div>

      <form method="post" action="/ask">
        <textarea name="query" placeholder="e.g. How much can I save if I earn ₹80K per year and spend ₹50K? I want to save ₹8K."></textarea>
        <div class="hint">Tip: I can read “80k / 1.2M”, monthly or yearly, and goals like “save 8k”.</div>
        <div class="examples">
          <span class="pill">I earn 60k, spend 40k</span>
          <span class="pill">Income 100k per year, spend 70k</span>
          <span class="pill">Earn 90k, spend 65k, want to save 10k</span>
        </div>
        <button type="submit">Get advice</button>
      </form>

      {% if result or advice or snippets %}
      <div class="result">
        {% if result %}
        <div class="kv">
          <div><strong>Predicted Savings:</strong></div><div>{{ result.Pred_Savings_XGB }}</div>
          {% if result.Cluster is not none %}
            <div><strong>Cluster:</strong></div><div>{{ result.Cluster }}</div>
          {% endif %}
          {% if result.Persona %}
            <div><strong>Persona:</strong></div><div>{{ result.Persona }}</div>
          {% endif %}
          {% if result.Goal_Prob is defined and result.Goal_Prob is not none %}
            <div><strong>Goal Probability:</strong></div><div>{{ result.Goal_Prob }}</div>
            <div><strong>Goal Label:</strong></div><div>{{ result.Goal_Label }}</div>
          {% endif %}
        </div>
        {% endif %}

        {% if advice %}
          <div class="advice"><strong>Advice:</strong> {{ advice }}</div>
        {% endif %}

        {% if snippets %}
          <div class="advice" style="margin-top:.75rem;">
            <strong>Why this advice?</strong>
            <ul style="margin:0.5rem 0 0 1rem;">
              {% for s in snippets %}
                <li>
                  {{ s.text[:220] }}{% if s.text|length > 220 %}…{% endif %}
                  <div style="font-size:0.9em; opacity:.7;">
                    Source: {{ s.title }} ({{ s.source }}#{{ s.chunk }})
                  </div>
                </li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}
      </div>
      {% endif %}
    </div>
  </div>
</body>
</html>
